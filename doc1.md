深入理解程序设计一
==

汇编与链接执行
```
# 使用如下命令汇编与链接
$ as -o test.o test.s
$ ld -o test test.o

# 目前在64位机器上编译与执行执行相关代码
$ as --32 -o create.o create.s
$ ld -m elf_i386 -o create create.o

# 之后就可以执行链接好的文件
./create
```

## 1. 引言

此处需要了解一下GCC工具集以及Linux的内核版本环境。
了解机器语言、汇编语言、高级语言

## 2. 计算机体系结构

### 2.1 内存结构
计算机内存是经过编号的一些列固定大小的存储单元，每个存储单元的编号成为该存储单元的地址。一个存储单元的大小成为一个字节。

### 2.2 CPU构造

CPU执行指令的步骤： 读取-执行周期（又称为指令周期或机器周期）

CPU包含以下元件：
- 程序计数器
- - 用来告诉计算机从哪里提取下一条指令
- - 程序计数器保存即将执行的下一条指令的内存地址
- 指令解码器：
- - 指令解码器给出的解释包括：需要进行何种处理（加法、减法、乘法、移动数据等），以及处理过程中将会涉及那些内存单元
- - 计算机指令通常由实际指令和执行指令要用到的内存单元列表构成
- 数据总线
- - 数据总线是CPU和内存间的物理连线，是联系两者的纽带
- 通用寄存器
- - CPU中有两种寄存器：通用寄存器和专用寄存器
- - 通用寄存器是进行主要运算的地方
- - 专用寄存器是用于特定用途的寄存器
- - 典型寄存器的大小称为计算机的字长
- 算术逻辑单元
- - 算术逻辑单元是实际执行指令的地方


现代CPU使用了多层高速缓存结构、超标量处理器、流水线、分之预测、乱序执行、微代码转换、协处理器以及其他复杂的优化技术

### 2.3 几个术语
- 字节
- 字长
- 指针
### 2.4 内存详解

### 2.5 寻址方式

计算机处理器有多种不同的数据访问方式，他们被称为寻址方式

- 立即寻址：指令本身即包含要访问的数据（例如，寄存器值初始化为0，指令中直接给出数字0，不需要告诉计算机到哪个地址读取0）
- 寄存器寻址：指令中包含要访问的寄存器，而不是内存位置
- 直接寻址方式（内存）：指令中包含要访问的内存地址
- 变址寻址方式（内存）：指令中除了包含一个要访问的内存的内存地址外，还需要指定一个变址寄存器，其中包含该地址的偏移量。（偏移量在寄存器，基地址为常数）
- 间接寻址方式：指令中包含一个寄存器，该寄存器中存储的是指向要访问数据的指针。
- 基址寻址方式：与间接寻址类似，但还需要包括一个叫做偏移量的值，将其与寄存器中的值相加后再用于寻址（偏移量为常数，基地址在寄存器）
 
### 2.6 知识总结与发散 


## 3. 编写第一个程序

### 3.1 汇编编程初体验, 汇编语言概要
参考文件 [example/exit.s](/example/exit.s)

#### 汇编代码的编译

编译汇编代码(带调试信息)
```
$ as --gstabs -o hello.o hello.s
$ ld -o hello hello.o
```

### 3.3 为程序做规划

### 3.4 查找最大值
参考文件 [example/maximum.s](/example/maximum.s)

### 3.5 寻址方式指令

内存地址引用的通用格式如下：
```
地址或者偏移(%基址寄存器,%索引寄存器,比例因子)
```
所有字段都可以选，计算地址的公式
```
结果地址 = 地址或者偏移 + %基址或偏移量寄存器 + 比例因子 * %索引寄存器
```
地址或者偏移以及比例因子都必须是常量，其余两个必须是寄存器。如果省略任何一项，那么等式中将以0代替该项

除了立即模式，所有其他寻址方式都可以用这种形式表示。

#### 直接寻址方式
此模式通过使用地址或偏移部分实现，
```
# 该指令将内存地址 ADDRESS加载到 %eax
movl ADDRESS, %eax
```

#### 索引寻址方式
此模式通过使用地址或偏移以及%索引寄存器部分实现。你可以将任何通用寄存器用作索引寄存器，也可以将索引寄存器的比例因子值常量定为 1,2,4，使之更适合为字节、双字节和字进行索引
```
# 该指令从string_start处开始，将该地址与 1*%ecx相加，并将所得值加载到%eax中
movl string_start(,%ecx,1), %eax
```

#### 间接寻址方式
间接寻址方式从寄存器指定的地址加载值
```
# 如下指令将 %eax中保存的地址中的值 移入 %ebx
movl (%eax), %ebx
```

#### 基址寻址方式
基址寻址方式与间接寻址方式类似，不同之处在于它将一个常量与寄存器中的地址相加
```
# 如下指令将 %eax 中保存的地址后4字节处 存储的值提取到 %ebx
movl 4(%eax), %ebx
```

#### 立即寻址方式
立即寻址方式非常简单。该方式会将直接值加载到寄存器或者存储位置
```
# 将数字12加载到%eax
movl $12, %eax
```

#### 寄存器寻址方式
寄存器寻址方式仅仅是将数据移入或者移出寄存器

#### 移动的数值大小
%eax为例子，如果你一次只想用两个字节，那么可以只使用 %ax
%ax是%eax寄存器最低有效字（即数值的后半部分），适合用于处理两个字节的数值
%ax可以进一步分成%al和%ah。
%al是%ax寄存器的最低有效半字，%ah是最高有效半字。

#### movl相关命令， movl,movw,movb
其中 x 可以是下面的字符：
    1，l用于32位的长字值
    2，w用于16位的字值
    3，b用于8位的字节值


### 3.6 温故知新
什么是原语？
在汇编中，原语通常就是系统调用